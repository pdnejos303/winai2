/* Path: src/lib/logger.ts
   ----------------------------------------------------------------------------
   üìÑ ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠:
   Global Logger ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö (‡∏ó‡∏±‡πâ‡∏á Backend ‡πÅ‡∏•‡∏∞ Middleware)
   - ‡πÉ‡∏ä‡πâ Pino ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö log
   - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ pretty-print ‡∏ï‡∏≠‡∏ô dev ‡πÅ‡∏•‡∏∞ raw JSON ‡∏ï‡∏≠‡∏ô production
   - ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á (‡πÄ‡∏ä‡πà‡∏ô token, password)
   ---------------------------------------------------------------------------- */

import pino from "pino"; // ‡πÉ‡∏ä‡πâ pino ‡πÄ‡∏õ‡πá‡∏ô logger ‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≤)

/**
 * üåê Global logger
 * ‚Ä¢ dev  ‚Üí pretty-print ‡∏î‡πâ‡∏ß‡∏¢ pino-pretty (‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢, ‡∏°‡∏µ‡∏™‡∏µ)
 * ‚Ä¢ prod ‚Üí log ‡πÄ‡∏õ‡πá‡∏ô JSON ‡∏î‡∏¥‡∏ö (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö production / log service ‡πÄ‡∏ä‡πà‡∏ô Datadog, Logstash)
 * ‚Ä¢ redact ‚Üí ‡∏ã‡πà‡∏≠‡∏ô field ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô log
 */
const logger = pino({
  transport:
    process.env.NODE_ENV === "production"
      ? undefined // ‚õî prod mode ‚Üí ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ transport (‡∏™‡πà‡∏á JSON ‡∏î‡∏¥‡∏ö)
      : {
          // ‚úÖ dev mode ‚Üí ‡πÉ‡∏ä‡πâ pino-pretty ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢
          target: "pino-pretty", // ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô object ‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ transport
          options: { colorize: true }, // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏µ‡πÉ‡∏ô console
        },
  redact: [
    // üõ°Ô∏è ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏à‡∏≤‡∏Å log (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)
    "req.headers.authorization", // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô token ‡∏´‡∏•‡∏∏‡∏î
    "passwordHash",              // ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å hash
    "access_token",
    "refresh_token",
    "id_token",
  ],
});

// üåü export logger ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
export default logger;
